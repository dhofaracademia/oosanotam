<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CAA OMAN | OOSA Digital OPS Concept</title>
    <!-- Branding Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --navy: #1d2551; --olive: #7b8b3e; --red: #d9534f; --gold: #f0ad4e; --bg: #f4f6f9; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; color: var(--navy); padding-bottom: 50px; }
        
        /* SAFETY BANNER */
        .safety-banner { background: #ffcc00; color: black; text-align: center; padding: 10px; font-weight: 800; border-bottom: 2px solid black; font-size: 0.9rem; letter-spacing: 1px; }

        /* HEADER */
        header { background: var(--navy); color: white; padding: 25px 40px; border-bottom: 6px solid var(--olive); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .logo-text h1 { margin: 0; font-size: 1.8rem; letter-spacing: 1px; }
        .logo-text p { margin: 0; color: var(--olive); font-weight: bold; font-size: 0.9rem; }
        .utc-clock { font-family: 'Courier New', monospace; font-size: 1.5rem; background: rgba(255,255,255,0.1); padding: 8px 20px; border-radius: 6px; border: 1px solid var(--olive); color: var(--gold); }

        /* GRID LAYOUT */
        .container { display: grid; grid-template-columns: 1fr 450px; gap: 25px; max-width: 1600px; margin: 30px auto; padding: 0 30px; }

        /* LEFT: NOTAM PARSER */
        .parser-box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        textarea { width: 100%; height: 120px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: monospace; font-size: 0.9rem; margin-top: 15px; transition: 0.3s; box-sizing: border-box; }
        textarea:focus { border-color: var(--olive); outline: none; }
        
        .btn-faa { display: inline-block; background: var(--navy); color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 0.9rem; margin-top: 10px; transition: 0.2s; }
        .btn-faa:hover { background: var(--olive); }

        /* RESULT CARDS */
        .card { background: white; border-radius: 10px; margin-top: 20px; display: flex; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); animation: slideIn 0.4s ease-out; border-left: 8px solid var(--navy); }
        .card-critical { border-left-color: var(--red); }
        .card-caution { border-left-color: var(--gold); }
        
        .icon-box { width: 70px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; font-size: 1.8rem; color: #ccc; }
        .content-box { padding: 15px 20px; flex: 1; }
        .header-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: bold; }
        .badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 12px; text-transform: uppercase; color: white; }
        .bg-red { background: var(--red); } .bg-gold { background: var(--gold); color: black; }
        
        .raw-text { font-size: 0.75rem; color: #777; font-family: monospace; margin-bottom: 8px; display: block; }
        .interpreted { font-size: 1rem; font-weight: 700; color: var(--navy); line-height: 1.4; }
        .abbr { color: var(--olive); text-decoration: underline dotted; cursor: help; }

        /* RIGHT: LIVE FEEDS */
        .sidebar { display: flex; flex-direction: column; gap: 25px; }
        .widget { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #e0e0e0; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .widget-header { background: var(--navy); color: white; padding: 10px 15px; font-size: 0.85rem; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<!-- LEGAL WARNING BANNER -->
<div class="safety-banner">
    ⚠️ DEMONSTRATION PROTOTYPE ONLY - NOT FOR OPERATIONAL USE - DATA MAY NOT BE CURRENT ⚠️
</div>

<header>
    <div class="logo-text">
        <h1>CAA OMAN | DIGITAL OPS</h1>
        <p>Strategic Operations Hub | Salalah (OOSA)</p>
    </div>
    <div class="utc-clock" id="clock">00:00:00 UTC</div>
</header>

<div class="container">
    
    <!-- LEFT COLUMN: INTELLIGENCE -->
    <section>
        <div class="parser-box">
            <h3 style="margin:0 0 10px 0;"><i class="fa-solid fa-robot"></i> AIS Smart Digitalizer</h3>
            <p style="margin:0; font-size:0.9rem; color:#666;">Convert raw NOTAM text into visual intelligence. Paste FAA data below.</p>
            
            <textarea id="notamInput" placeholder="Paste OOSA NOTAM text here... (Example: A0024/26 NOTAMN...)" oninput="processData()"></textarea>
            
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <a href="https://notams.aim.faa.gov/notamSearch/nsapp.html#/results?locationDesignators=OOSA" target="_blank" class="btn-faa">
                    <i class="fa-solid fa-search"></i> Open FAA Database
                </a>
                <span style="font-size:0.7rem; color:#999;">Parses ICAO Annex 11/14 abbreviations</span>
            </div>
        </div>

        <div id="resultsArea"></div>
    </section>

    <!-- RIGHT COLUMN: LIVE FEEDS -->
    <aside class="sidebar">
        <!-- WEATHER WIDGET -->
        <div class="widget">
            <div class="widget-header">
                <span>METEOROLOGICAL RADAR</span>
                <i class="fa-solid fa-cloud-bolt"></i>
            </div>
            <iframe width="100%" height="280" src="https://embed.windy.com/embed2.html?lat=17.09&lon=54.09&zoom=8&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&detailLat=17.09&detailLon=54.09&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
        </div>

        <!-- TRAFFIC WIDGET -->
        <div class="widget">
            <div class="widget-header">
                <span>LIVE AIR TRAFFIC (OOSA)</span>
                <i class="fa-solid fa-plane-departure"></i>
            </div>
            <iframe src="https://www.flightradar24.com/simple_index.php?lat=17.09&lon=54.09&z=9" width="100%" height="280" frameborder="0"></iframe>
        </div>
    </aside>

</div>

<script>
    // 1. CLOCK
    function updateTime() {
        const now = new Date();
        document.getElementById('clock').innerText = 
            now.getUTCHours().toString().padStart(2, '0') + ":" + 
            now.getUTCMinutes().toString().padStart(2, '0') + ":" + 
            now.getUTCSeconds().toString().padStart(2, '0') + " UTC";
    }
    setInterval(updateTime, 1000); updateTime();

    // 2. DICTIONARY
    const terms = {
        "WIP": "Work In Progress", "TWY": "Taxiway", "RWY": "Runway", 
        "LGT": "Lighting System", "SID": "Standard Instrument Departure", 
        "ILS": "Instrument Landing System", "NA": "NOT AUTHORIZED", 
        "U/S": "Unserviceable", "CTN": "Caution", "OBST": "Obstacle"
    };

    // 3. PARSER
    function processData() {
        const input = document.getElementById('notamInput').value;
        const output = document.getElementById('resultsArea');
        output.innerHTML = "";

        // Regex to find NOTAMs (Matches A0000/00 or V0000/00)
        const chunks = input.split(/(?=[A-Z]\d{4}\/\d{2})/);

        chunks.forEach(txt => {
            if(txt.trim().length < 15) return;

            // Extract ID and Body
            const idMatch = txt.match(/([A-Z]\d{4}\/\d{2})/);
            const id = idMatch ? idMatch[1] : "NOTAM";
            
            // Try to find the E) field, otherwise take the whole text
            let body = txt.split('E)')[1] ? txt.split('E)')[1].split(/[A-Z]\)/)[0].trim() : txt;

            // Determine Status
            let isCrit = body.includes("NOT AUTHORIZED") || body.includes("NA") || body.includes("CLOSED");
            let isCaut = body.includes("WIP") || body.includes("CAUTION") || body.includes("CTN");
            
            // Assign Styles
            let borderClass = isCrit ? "card-critical" : (isCaut ? "card-caution" : "");
            let icon = isCrit ? "fa-circle-xmark" : (isCaut ? "fa-triangle-exclamation" : "fa-circle-info");
            let iconColor = isCrit ? "var(--red)" : (isCaut ? "var(--gold)" : "#ccc");
            let badge = isCrit ? '<span class="badge bg-red">SAFETY CRITICAL</span>' : (isCaut ? '<span class="badge bg-gold">CAUTION</span>' : '');

            // Highlight Terms
            let smartText = body;
            Object.keys(terms).forEach(key => {
                const rgx = new RegExp(`\\b${key}\\b`, 'g');
                smartText = smartText.replace(rgx, `<span class="abbr" title="${terms[key]}">${key}</span>`);
            });

            // Build HTML
            const card = document.createElement('div');
            card.className = `card ${borderClass}`;
            card.innerHTML = `
                <div class="icon-box" style="color: ${iconColor}"><i class="fa-solid ${icon}"></i></div>
                <div class="content-box">
                    <div class="header-line">
                        <span>${id}</span>
                        ${badge}
                    </div>
                    <span class="raw-text">RAW: ${body.substring(0,60)}...</span>
                    <div class="interpreted">${smartText}</div>
                </div>
            `;
            output.appendChild(card);
        });
    }
</script>

</body>
</html>